{% doc %}
  @prompt
    I want you to create a section where testimonial cards are shown, these cards has name, image and text for feedbakc, this section is fully controlable in theme editor for formatting etc. and fully responsive for each scree, other than desktop it should show 1 card and scrolling arrows on sides dots below. card design is sleek and matching with the theme design. , on mobile the arrows should be on both sides left/right and card had a subtle padding around from screen. the color of stars is black and on mobile screen image should not be displayed. 
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-testimonials-{{ ai_gen_id }} {
    padding: {{ block.settings.section_padding_top }}px 0 {{ block.settings.section_padding_bottom }}px;
    background-color: {{ block.settings.background_color }};
  }

  .ai-testimonials-container-{{ ai_gen_id }} {
    max-width: {{ block.settings.container_width }}px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .ai-testimonials-heading-{{ ai_gen_id }} {
    text-align: {{ block.settings.heading_alignment }};
    margin-bottom: {{ block.settings.heading_spacing }}px;
  }

  .ai-testimonials-title-{{ ai_gen_id }} {
    font-size: {{ block.settings.heading_size }}px;
    color: {{ block.settings.heading_color }};
    margin: 0;
  }

  .ai-testimonials-carousel-wrapper-{{ ai_gen_id }} {
    position: relative;
    margin-top: 40px;
  }

  .ai-testimonials-carousel-{{ ai_gen_id }} {
    overflow: hidden;
    position: relative;
  }

  .ai-testimonials-track-{{ ai_gen_id }} {
    display: flex;
    transition: transform 0.5s ease;
  }

  .ai-testimonial-card-{{ ai_gen_id }} {
    flex: 0 0 100%;
    padding: 0 10px;
    box-sizing: border-box;
  }

  .ai-testimonial-card-inner-{{ ai_gen_id }} {
    background-color: {{ block.settings.card_background }};
    border-radius: {{ block.settings.card_border_radius }}px;
    padding: {{ block.settings.card_padding }}px;
    box-shadow: {{ block.settings.card_shadow_x }}px {{ block.settings.card_shadow_y }}px {{ block.settings.card_shadow_blur }}px {{ block.settings.card_shadow_color }};
    display: flex;
    flex-direction: column;
    gap: 20px;
    height: 100%;
  }

  .ai-testimonial-header-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .ai-testimonial-image-{{ ai_gen_id }} {
    width: {{ block.settings.image_size }}px;
    height: {{ block.settings.image_size }}px;
    border-radius: 50%;
    object-fit: cover;
    flex-shrink: 0;
  }

  .ai-testimonial-image-placeholder-{{ ai_gen_id }} {
    width: {{ block.settings.image_size }}px;
    height: {{ block.settings.image_size }}px;
    border-radius: 50%;
    background-color: #f4f4f4;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    overflow: hidden;
  }

  .ai-testimonial-image-placeholder-{{ ai_gen_id }} svg {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ai-testimonial-info-{{ ai_gen_id }} {
    flex-grow: 1;
  }

  .ai-testimonial-name-{{ ai_gen_id }} {
    font-size: {{ block.settings.name_size }}px;
    color: {{ block.settings.name_color }};
    margin: 0 0 8px 0;
    font-weight: 600;
  }

  .ai-testimonial-stars-{{ ai_gen_id }} {
    display: flex;
    gap: 4px;
  }

  .ai-testimonial-star-{{ ai_gen_id }} {
    width: {{ block.settings.star_size }}px;
    height: {{ block.settings.star_size }}px;
    fill: {{ block.settings.star_color }};
  }

  .ai-testimonial-text-{{ ai_gen_id }} {
    font-size: {{ block.settings.text_size }}px;
    color: {{ block.settings.text_color }};
    line-height: 1.6;
    margin: 0;
  }

  .ai-testimonials-nav-{{ ai_gen_id }} {
    display: none;
  }

  .ai-testimonials-arrow-{{ ai_gen_id }} {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background-color: {{ block.settings.arrow_background }};
    border: none;
    width: {{ block.settings.arrow_size }}px;
    height: {{ block.settings.arrow_size }}px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2;
    transition: background-color 0.3s ease;
  }

  .ai-testimonials-arrow-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.arrow_hover_background }};
  }

  .ai-testimonials-arrow-{{ ai_gen_id }} svg {
    width: 20px;
    height: 20px;
    fill: {{ block.settings.arrow_color }};
  }

  .ai-testimonials-arrow-prev-{{ ai_gen_id }} {
    left: -20px;
  }

  .ai-testimonials-arrow-next-{{ ai_gen_id }} {
    right: -20px;
  }

  .ai-testimonials-dots-{{ ai_gen_id }} {
    display: none;
    justify-content: center;
    gap: 8px;
    margin-top: 24px;
  }

  .ai-testimonials-dot-{{ ai_gen_id }} {
    width: {{ block.settings.dot_size }}px;
    height: {{ block.settings.dot_size }}px;
    border-radius: 50%;
    background-color: {{ block.settings.dot_color }};
    border: none;
    cursor: pointer;
    padding: 0;
    transition: background-color 0.3s ease;
  }

  .ai-testimonials-dot-{{ ai_gen_id }}.active {
    background-color: {{ block.settings.dot_active_color }};
  }

  @media screen and (min-width: 750px) {
    .ai-testimonials-track-{{ ai_gen_id }} {
      flex-wrap: nowrap;
    }

    .ai-testimonial-card-{{ ai_gen_id }} {
      flex: 0 0 calc(100% / {{ block.settings.cards_per_row }});
    }

    .ai-testimonials-nav-{{ ai_gen_id }} {
      display: block;
    }

    .ai-testimonials-dots-{{ ai_gen_id }} {
      display: flex;
    }
  }

  @media screen and (max-width: 749px) {
    .ai-testimonials-{{ ai_gen_id }} {
      padding: {{ block.settings.section_padding_top | times: 0.7 }}px 0 {{ block.settings.section_padding_bottom | times: 0.7 }}px;
    }

    .ai-testimonials-container-{{ ai_gen_id }} {
      padding: 0 {{ block.settings.mobile_padding }}px;
    }

    .ai-testimonial-card-{{ ai_gen_id }} {
      padding: 0;
    }

    .ai-testimonial-image-{{ ai_gen_id }},
    .ai-testimonial-image-placeholder-{{ ai_gen_id }} {
      display: none;
    }

    .ai-testimonials-nav-{{ ai_gen_id }} {
      display: block;
    }

    .ai-testimonials-arrow-prev-{{ ai_gen_id }} {
      left: 10px;
    }

    .ai-testimonials-arrow-next-{{ ai_gen_id }} {
      right: 10px;
    }

    .ai-testimonials-dots-{{ ai_gen_id }} {
      display: flex;
    }

    .ai-testimonials-title-{{ ai_gen_id }} {
      font-size: {{ block.settings.heading_size | times: 0.8 }}px;
    }
  }
{% endstyle %}

<testimonials-carousel-{{ ai_gen_id }} class="ai-testimonials-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-testimonials-container-{{ ai_gen_id }}">
    {% if block.settings.heading != blank %}
      <div class="ai-testimonials-heading-{{ ai_gen_id }}">
        <h2 class="ai-testimonials-title-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
      </div>
    {% endif %}

    <div class="ai-testimonials-carousel-wrapper-{{ ai_gen_id }}">
      <div class="ai-testimonials-carousel-{{ ai_gen_id }}">
        <div class="ai-testimonials-track-{{ ai_gen_id }}">
          {% for i in (1..6) %}
            {% liquid
              assign name_key = 'testimonial_' | append: i | append: '_name'
              assign image_key = 'testimonial_' | append: i | append: '_image'
              assign text_key = 'testimonial_' | append: i | append: '_text'
              assign rating_key = 'testimonial_' | append: i | append: '_rating'

              assign name = block.settings[name_key]
              assign image = block.settings[image_key]
              assign text = block.settings[text_key]
              assign rating = block.settings[rating_key]
            %}

            {% if name != blank or text != blank %}
              <div class="ai-testimonial-card-{{ ai_gen_id }}">
                <div class="ai-testimonial-card-inner-{{ ai_gen_id }}">
                  <div class="ai-testimonial-header-{{ ai_gen_id }}">
                    {% if image %}
                      <img
                        src="{{ image | image_url: width: 200 }}"
                        alt="{{ name | escape }}"
                        class="ai-testimonial-image-{{ ai_gen_id }}"
                        loading="lazy"
                        width="200"
                        height="200"
                      >
                    {% else %}
                      <div class="ai-testimonial-image-placeholder-{{ ai_gen_id }}">
                        {{ 'image' | placeholder_svg_tag }}
                      </div>
                    {% endif %}

                    <div class="ai-testimonial-info-{{ ai_gen_id }}">
                      {% if name != blank %}
                        <h3 class="ai-testimonial-name-{{ ai_gen_id }}">{{ name }}</h3>
                      {% endif %}

                      <div class="ai-testimonial-stars-{{ ai_gen_id }}">
                        {% for star in (1..rating) %}
                          <svg class="ai-testimonial-star-{{ ai_gen_id }}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                          </svg>
                        {% endfor %}
                      </div>
                    </div>
                  </div>

                  {% if text != blank %}
                    <p class="ai-testimonial-text-{{ ai_gen_id }}">{{ text }}</p>
                  {% endif %}
                </div>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <div class="ai-testimonials-nav-{{ ai_gen_id }}">
        <button class="ai-testimonials-arrow-{{ ai_gen_id }} ai-testimonials-arrow-prev-{{ ai_gen_id }}" aria-label="Previous testimonial">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
          </svg>
        </button>
        <button class="ai-testimonials-arrow-{{ ai_gen_id }} ai-testimonials-arrow-next-{{ ai_gen_id }}" aria-label="Next testimonial">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
          </svg>
        </button>
      </div>

      <div class="ai-testimonials-dots-{{ ai_gen_id }}"></div>
    </div>
  </div>
</testimonials-carousel-{{ ai_gen_id }}>

<script>
  (function() {
    class TestimonialsCarousel{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.currentIndex = 0;
        this.isDesktop = window.innerWidth >= 750;
        this.cardsPerView = this.isDesktop ? {{ block.settings.cards_per_row }} : 1;
      }

      connectedCallback() {
        this.track = this.querySelector('.ai-testimonials-track-{{ ai_gen_id }}');
        this.cards = this.querySelectorAll('.ai-testimonial-card-{{ ai_gen_id }}');
        this.prevButton = this.querySelector('.ai-testimonials-arrow-prev-{{ ai_gen_id }}');
        this.nextButton = this.querySelector('.ai-testimonials-arrow-next-{{ ai_gen_id }}');
        this.dotsContainer = this.querySelector('.ai-testimonials-dots-{{ ai_gen_id }}');

        this.totalCards = this.cards.length;
        this.totalSlides = Math.ceil(this.totalCards / this.cardsPerView);

        this.createDots();
        this.setupEventListeners();
        this.updateCarousel();

        window.addEventListener('resize', () => {
          const wasDesktop = this.isDesktop;
          this.isDesktop = window.innerWidth >= 750;
          this.cardsPerView = this.isDesktop ? {{ block.settings.cards_per_row }} : 1;
          
          if (wasDesktop !== this.isDesktop) {
            this.totalSlides = Math.ceil(this.totalCards / this.cardsPerView);
            this.currentIndex = 0;
            this.createDots();
            this.updateCarousel();
          }
        });
      }

      createDots() {
        this.dotsContainer.innerHTML = '';
        for (let i = 0; i < this.totalSlides; i++) {
          const dot = document.createElement('button');
          dot.classList.add('ai-testimonials-dot-{{ ai_gen_id }}');
          if (i === 0) dot.classList.add('active');
          dot.setAttribute('aria-label', `Go to slide ${i + 1}`);
          dot.addEventListener('click', () => this.goToSlide(i));
          this.dotsContainer.appendChild(dot);
        }
        this.dots = this.querySelectorAll('.ai-testimonials-dot-{{ ai_gen_id }}');
      }

      setupEventListeners() {
        this.prevButton.addEventListener('click', () => this.prev());
        this.nextButton.addEventListener('click', () => this.next());

        let startX = 0;
        let endX = 0;

        this.track.addEventListener('touchstart', (e) => {
          startX = e.touches[0].clientX;
        });

        this.track.addEventListener('touchend', (e) => {
          endX = e.changedTouches[0].clientX;
          if (startX - endX > 50) {
            this.next();
          } else if (endX - startX > 50) {
            this.prev();
          }
        });
      }

      prev() {
        this.currentIndex = (this.currentIndex - 1 + this.totalSlides) % this.totalSlides;
        this.updateCarousel();
      }

      next() {
        this.currentIndex = (this.currentIndex + 1) % this.totalSlides;
        this.updateCarousel();
      }

      goToSlide(index) {
        this.currentIndex = index;
        this.updateCarousel();
      }

      updateCarousel() {
        const offset = -this.currentIndex * (100 / this.cardsPerView);
        this.track.style.transform = `translateX(${offset}%)`;

        this.dots.forEach((dot, index) => {
          if (index === this.currentIndex) {
            dot.classList.add('active');
          } else {
            dot.classList.remove('active');
          }
        });
      }
    }

    customElements.define('testimonials-carousel-{{ ai_gen_id }}', TestimonialsCarousel{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Testimonials carousel",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Section"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "label": "Heading",
      "default": "What our customers say"
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "Heading alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "container_width",
      "min": 600,
      "max": 1400,
      "step": 50,
      "unit": "px",
      "label": "Container width",
      "default": 1200
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Top padding",
      "default": 60
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Bottom padding",
      "default": 60
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "cards_per_row",
      "min": 1,
      "max": 4,
      "step": 1,
      "label": "Cards per row (desktop)",
      "default": 3
    },
    {
      "type": "range",
      "id": "mobile_padding",
      "min": 10,
      "max": 40,
      "step": 5,
      "unit": "px",
      "label": "Mobile side padding",
      "default": 20
    },
    {
      "type": "header",
      "content": "Card style"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card background",
      "default": "#f9f9f9"
    },
    {
      "type": "range",
      "id": "card_padding",
      "min": 15,
      "max": 50,
      "step": 5,
      "unit": "px",
      "label": "Card padding",
      "default": 30
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "Card border radius",
      "default": 12
    },
    {
      "type": "range",
      "id": "card_shadow_x",
      "min": -10,
      "max": 10,
      "step": 1,
      "unit": "px",
      "label": "Shadow X offset",
      "default": 0
    },
    {
      "type": "range",
      "id": "card_shadow_y",
      "min": -10,
      "max": 10,
      "step": 1,
      "unit": "px",
      "label": "Shadow Y offset",
      "default": 2
    },
    {
      "type": "range",
      "id": "card_shadow_blur",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "Shadow blur",
      "default": 10
    },
    {
      "type": "color",
      "id": "card_shadow_color",
      "label": "Shadow color",
      "default": "rgba(0,0,0,0.1)"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 20,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 36
    },
    {
      "type": "range",
      "id": "heading_spacing",
      "min": 10,
      "max": 60,
      "step": 5,
      "unit": "px",
      "label": "Heading spacing",
      "default": 30
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "name_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Name size",
      "default": 18
    },
    {
      "type": "color",
      "id": "name_color",
      "label": "Name color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "text_size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Text size",
      "default": 15
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#666666"
    },
    {
      "type": "header",
      "content": "Image & stars"
    },
    {
      "type": "range",
      "id": "image_size",
      "min": 40,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Image size",
      "default": 60
    },
    {
      "type": "range",
      "id": "star_size",
      "min": 12,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "Star size",
      "default": 16
    },
    {
      "type": "color",
      "id": "star_color",
      "label": "Star color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "range",
      "id": "arrow_size",
      "min": 30,
      "max": 60,
      "step": 5,
      "unit": "px",
      "label": "Arrow size",
      "default": 45
    },
    {
      "type": "color",
      "id": "arrow_background",
      "label": "Arrow background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "arrow_hover_background",
      "label": "Arrow hover background",
      "default": "#f0f0f0"
    },
    {
      "type": "color",
      "id": "arrow_color",
      "label": "Arrow icon color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "dot_size",
      "min": 6,
      "max": 16,
      "step": 2,
      "unit": "px",
      "label": "Dot size",
      "default": 10
    },
    {
      "type": "color",
      "id": "dot_color",
      "label": "Dot color",
      "default": "#cccccc"
    },
    {
      "type": "color",
      "id": "dot_active_color",
      "label": "Active dot color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Testimonial 1"
    },
    {
      "type": "text",
      "id": "testimonial_1_name",
      "label": "Name",
      "default": "Sarah Johnson"
    },
    {
      "type": "image_picker",
      "id": "testimonial_1_image",
      "label": "Image"
    },
    {
      "type": "range",
      "id": "testimonial_1_rating",
      "min": 1,
      "max": 5,
      "step": 1,
      "label": "Rating",
      "default": 5
    },
    {
      "type": "textarea",
      "id": "testimonial_1_text",
      "label": "Feedback",
      "default": "Absolutely love this product! The quality exceeded my expectations and the customer service was outstanding."
    },
    {
      "type": "header",
      "content": "Testimonial 2"
    },
    {
      "type": "text",
      "id": "testimonial_2_name",
      "label": "Name",
      "default": "Michael Chen"
    },
    {
      "type": "image_picker",
      "id": "testimonial_2_image",
      "label": "Image"
    },
    {
      "type": "range",
      "id": "testimonial_2_rating",
      "min": 1,
      "max": 5,
      "step": 1,
      "label": "Rating",
      "default": 5
    },
    {
      "type": "textarea",
      "id": "testimonial_2_text",
      "label": "Feedback",
      "default": "Best purchase I've made this year. Fast shipping and the product works exactly as described."
    },
    {
      "type": "header",
      "content": "Testimonial 3"
    },
    {
      "type": "text",
      "id": "testimonial_3_name",
      "label": "Name",
      "default": "Emma Williams"
    },
    {
      "type": "image_picker",
      "id": "testimonial_3_image",
      "label": "Image"
    },
    {
      "type": "range",
      "id": "testimonial_3_rating",
      "min": 1,
      "max": 5,
      "step": 1,
      "label": "Rating",
      "default": 5
    },
    {
      "type": "textarea",
      "id": "testimonial_3_text",
      "label": "Feedback",
      "default": "Highly recommend! Great value for money and the team was very helpful with my questions."
    },
    {
      "type": "header",
      "content": "Testimonial 4"
    },
    {
      "type": "text",
      "id": "testimonial_4_name",
      "label": "Name"
    },
    {
      "type": "image_picker",
      "id": "testimonial_4_image",
      "label": "Image"
    },
    {
      "type": "range",
      "id": "testimonial_4_rating",
      "min": 1,
      "max": 5,
      "step": 1,
      "label": "Rating",
      "default": 5
    },
    {
      "type": "textarea",
      "id": "testimonial_4_text",
      "label": "Feedback"
    },
    {
      "type": "header",
      "content": "Testimonial 5"
    },
    {
      "type": "text",
      "id": "testimonial_5_name",
      "label": "Name"
    },
    {
      "type": "image_picker",
      "id": "testimonial_5_image",
      "label": "Image"
    },
    {
      "type": "range",
      "id": "testimonial_5_rating",
      "min": 1,
      "max": 5,
      "step": 1,
      "label": "Rating",
      "default": 5
    },
    {
      "type": "textarea",
      "id": "testimonial_5_text",
      "label": "Feedback"
    },
    {
      "type": "header",
      "content": "Testimonial 6"
    },
    {
      "type": "text",
      "id": "testimonial_6_name",
      "label": "Name"
    },
    {
      "type": "image_picker",
      "id": "testimonial_6_image",
      "label": "Image"
    },
    {
      "type": "range",
      "id": "testimonial_6_rating",
      "min": 1,
      "max": 5,
      "step": 1,
      "label": "Rating",
      "default": 5
    },
    {
      "type": "textarea",
      "id": "testimonial_6_text",
      "label": "Feedback"
    }
  ],
  "presets": [
    {
      "name": "Testimonials carousel"
    }
  ]
}
{% endschema %}
