{% schema %}
{
  "name": "Collection Showcase",
  "settings": [
    {
      "type": "number",
      "id": "initial_show",
      "label": "Collections to show initially",
      "default": 3,
      
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Choose Collection"
        }
      ]
    }
  ],
  "max_blocks": 9,
  "presets": [
    {
      "name": "Collection Showcase"
    }
  ]
}
{% endschema %}

<div id="collection-showcase" class="w-full px-4 py-10">
  {% assign coll_blocks = section.blocks %}
  {% assign shown = section.settings.initial_show | default: 6 %}
  {% assign coll_size = coll_blocks | size %}
  {% assign loop_max = coll_size | minus: 1 %}
  <div id="collection-grid" class="flex flex-col space-y-8">
    {% for i in (0..loop_max) %}
      {% assign block = coll_blocks[i] %}
      {% assign collection = block.settings.collection %}
      {% assign current_row = i | divided_by: 3 %}
      {% assign position = i | modulo: 3 %}
      {% assign row_even = current_row | modulo: 2 %}
      {% assign next_index1 = i | plus: 1 %}
      {% assign next_index2 = i | plus: 2 %}
      <div data-index="{{ i }}"
        class="w-full flex flex-col md:flex-row gap-4 {% if i >= shown %}hidden{% endif %}">
        {% if row_even == 0 %}
          {% if position == 0 %}
            <div class="md:w-2/3 flex flex-col justify-center items-center">
              {% if collection %}
                <a href="{{ collection.url }}" class="block group w-full">
                  <img src="{{ collection.image | img_url: '700x700' }}" alt="{{ collection.title }}"
                    class="rounded-xl object-cover w-full h-60 transition-transform group-hover:scale-105 duration-150" loading="lazy">
                  <div class="mt-3 text-lg font-bold text-gray-800">{{ collection.title }}</div>
                </a>
              {% endif %}
            </div>
            <div class="md:w-1/3 flex flex-col space-y-4">
              {% if next_index1 < coll_size and coll_blocks[next_index1].settings.collection %}
                <a href="{{ coll_blocks[next_index1].settings.collection.url }}" class="block group">
                  <img src="{{ coll_blocks[next_index1].settings.collection.image | img_url: '400x400' }}" alt="{{ coll_blocks[next_index1].settings.collection.title }}"
                    class="rounded-md object-cover w-full h-28 transition-transform group-hover:scale-105 duration-150" loading="lazy">
                  <div class="mt-2 text-base font-semibold text-gray-700">{{ coll_blocks[next_index1].settings.collection.title }}</div>
                </a>
              {% endif %}
              {% if next_index2 < coll_size and coll_blocks[next_index2].settings.collection %}
                <a href="{{ coll_blocks[next_index2].settings.collection.url }}" class="block group">
                  <img src="{{ coll_blocks[next_index2].settings.collection.image | img_url: '400x400' }}" alt="{{ coll_blocks[next_index2].settings.collection.title }}"
                    class="rounded-md object-cover w-full h-28 transition-transform group-hover:scale-105 duration-150" loading="lazy">
                  <div class="mt-2 text-base font-semibold text-gray-700">{{ coll_blocks[next_index2].settings.collection.title }}</div>
                </a>
              {% endif %}
            </div>
          {% endif %}
        {% else %}
          {% if position == 0 %}
            <div class="md:w-1/3 flex flex-col space-y-4">
              {% if next_index1 < coll_size and coll_blocks[next_index1].settings.collection %}
                <a href="{{ coll_blocks[next_index1].settings.collection.url }}" class="block group">
                  <img src="{{ coll_blocks[next_index1].settings.collection.image | img_url: '400x400' }}" alt="{{ coll_blocks[next_index1].settings.collection.title }}"
                    class="rounded-md object-cover w-full h-28 transition-transform group-hover:scale-105 duration-150" loading="lazy">
                  <div class="mt-2 text-base font-semibold text-gray-700">{{ coll_blocks[next_index1].settings.collection.title }}</div>
                </a>
              {% endif %}
              {% if next_index2 < coll_size and coll_blocks[next_index2].settings.collection %}
                <a href="{{ coll_blocks[next_index2].settings.collection.url }}" class="block group">
                  <img src="{{ coll_blocks[next_index2].settings.collection.image | img_url: '400x400' }}" alt="{{ coll_blocks[next_index2].settings.collection.title }}"
                    class="rounded-md object-cover w-full h-28 transition-transform group-hover:scale-105 duration-150" loading="lazy">
                  <div class="mt-2 text-base font-semibold text-gray-700">{{ coll_blocks[next_index2].settings.collection.title }}</div>
                </a>
              {% endif %}
            </div>
            <div class="md:w-2/3 flex flex-col justify-center items-center">
              {% if collection %}
                <a href="{{ collection.url }}" class="block group w-full">
                  <img src="{{ collection.image | img_url: '700x700' }}" alt="{{ collection.title }}"
                    class="rounded-xl object-cover w-full h-60 transition-transform group-hover:scale-105 duration-150" loading="lazy">
                  <div class="mt-3 text-lg font-bold text-gray-800">{{ collection.title }}</div>
                </a>
              {% endif %}
            </div>
          {% endif %}
        {% endif %}
      </div>
    {% endfor %}
  </div>
  {% if coll_size > shown %}
    <div class="pt-9 flex justify-center">
      <button type="button"
        id="load-more-btn"
        class="block px-6 py-2 bg-black text-white rounded-full font-semibold hover:bg-gray-800 transition"
        onclick="loadMoreShowcase()">
        Load More
      </button>
    </div>
  {% endif %}
</div>
<script>
  let showcaseShown = {{ shown }};
  const showcaseTotal = {{ coll_size }};
  function loadMoreShowcase() {
    const grid = document.getElementById('collection-grid');
    const items = grid.children;
    let toShow = Math.min(showcaseShown + 3, showcaseTotal);
    for (let i = showcaseShown; i < toShow; i++) {
      if(items[i]) items[i].classList.remove('hidden');
    }
    showcaseShown = toShow;
    if (showcaseShown >= showcaseTotal) {
      document.getElementById('load-more-btn').style.display = 'none';
    }
  }
</script>
