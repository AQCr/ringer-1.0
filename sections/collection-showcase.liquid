{% comment %}
Section: Collection Showcase
- Right: large image for active collection
- Left: vertical stack of horizontal thumbnails (3 shown initially)
- Supports up to 10 collection blocks (choose each collection in the theme editor)
- If >3 collections, "Load more" button appears and reveals the rest
- Clicking a thumbnail swaps the large image (client-side)
{% endcomment %}

<section id="collection-showcase-{{ section.id }}" class="collection-showcase-section">
  <div class="wrapper">
    {% assign total = section.blocks | size %}
    {% if total == 0 %}
      <p class="no-collections">No collections selected. Use the theme editor to add up to 10 collection blocks.</p>
    {% else %}
      <div class="cs-grid">
        <div class="cs-left">
          {% for block in section.blocks %}
            {% assign idx = forloop.index0 %}
            {% assign coll = block.settings.collection %}
            {% assign img_src = coll.image | img_url: '800x' %}
            {% if img_src == blank %}
              {% assign img_src = 'https://via.placeholder.com/800x600?text=No+Image' %}
            {% endif %}
            <a
              href="{{ coll.url }}"
              class="cs-thumb {% if idx >= 3 %}cs-hidden{% endif %}"
              data-index="{{ idx }}"
              data-img="{{ img_src | escape }}"
              data-title="{{ coll.title | escape }}"
            >
              <img src="{{ img_src }}" alt="{{ coll.title | escape }}" loading="lazy">
              <div class="cs-thumb-title">{{ coll.title }}</div>
            </a>
          {% endfor %}

          {% if total > 3 %}
            <button type="button" class="cs-load-more" aria-expanded="false">
              Load more collections ({{ total | minus: 3 }})
            </button>
          {% endif %}
        </div>

        <div class="cs-right">
          {% comment %} Show first collection as active large image {% endcomment %}
          {% assign first = section.blocks.first.settings.collection %}
          {% assign first_img = first.image | img_url: '1200x1200' %}
          {% if first_img == blank %}
            {% assign first_img = 'https://via.placeholder.com/1200x800?text=No+Image' %}
          {% endif %}
          <a href="{{ first.url }}" class="cs-large" id="cs-large-link">
            <img id="cs-large-img" src="{{ first_img }}" alt="{{ first.title | escape }}" loading="lazy">
            <div class="cs-large-title" id="cs-large-title">{{ first.title }}</div>
          </a>
        </div>
      </div>
    {% endif %}
  </div>

  <style>
    /* Basic layout */
    #collection-showcase-{{ section.id }} { padding: 24px 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    #collection-showcase-{{ section.id }} .wrapper { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
    .cs-grid { display: flex; gap: 20px; align-items: stretch; }
    .cs-left { width: 38%; display: flex; flex-direction: column; }
    .cs-right { width: 62%; display: flex; align-items: center; justify-content: center; }

    /* Thumbnails (left column) */
    .cs-thumb { display: block; position: relative; text-decoration: none; color: inherit; margin-bottom: 14px; transition: transform .18s ease, box-shadow .18s ease; }
    .cs-thumb img { width: 100%; height: 110px; object-fit: cover; border-radius: 14px; box-shadow: 0 8px 18px rgba(0,0,0,.08); display: block; }
    .cs-thumb-title { position: absolute; left: 12px; bottom: 10px; right: 12px; color: #fff; font-weight: 600; text-shadow: 0 2px 6px rgba(0,0,0,.5); font-size: 14px; pointer-events: none; }
    .cs-thumb:hover { transform: translateY(-4px); box-shadow: 0 14px 30px rgba(0,0,0,.12); }

    /* Hidden thumbnails (initially) */
    .cs-hidden { display: none; }

    /* Load more button */
    .cs-load-more { background: #111; color: #fff; border: none; padding: 10px 14px; border-radius: 10px; cursor: pointer; font-weight: 600; margin-top: 6px; width: fit-content; }
    .cs-load-more:focus { outline: 2px solid #6cb4ff; outline-offset: 2px; }

    /* Large image (right column) */
    .cs-large { display: block; width: 100%; border-radius: 16px; overflow: hidden; text-decoration: none; color: inherit; box-shadow: 0 18px 40px rgba(0,0,0,.12); position: relative; }
    #cs-large-img { width: 100%; height: 420px; object-fit: cover; display: block; }
    .cs-large-title { position: absolute; left: 24px; bottom: 18px; color: #fff; font-size: 22px; font-weight: 700; text-shadow: 0 4px 14px rgba(0,0,0,.5); }

    /* Responsive */
    @media (max-width: 900px) {
      .cs-grid { flex-direction: column-reverse; }
      .cs-left, .cs-right { width: 100%; }
      .cs-left { flex-direction: row; flex-wrap: nowrap; overflow-x: auto; gap: 12px; padding-bottom: 6px; }
      .cs-thumb { min-width: 260px; margin-bottom: 0; }
      .cs-thumb img { height: 140px; border-radius: 12px; }
      #cs-large-img { height: 320px; }
    }
  </style>

  <script>
    (function(){
      var sectionId = '{{ section.id }}';
      var container = document.getElementById('collection-showcase-{{ section.id }}');
      if (!container) return;

      // Thumbnail click -> swap large image
      container.querySelectorAll('.cs-thumb').forEach(function(thumb){
        thumb.addEventListener('click', function(evt){
          evt.preventDefault();
          var img = thumb.getAttribute('data-img');
          var title = thumb.getAttribute('data-title');
          var href = thumb.getAttribute('href');
          var largeImg = container.querySelector('#cs-large-img');
          var largeLink = container.querySelector('#cs-large-link');
          var largeTitle = container.querySelector('#cs-large-title');

          if (largeImg && img) {
            largeImg.setAttribute('src', img);
            largeImg.setAttribute('alt', title);
          }
          if (largeLink && href) {
            largeLink.setAttribute('href', href);
          }
          if (largeTitle) {
            largeTitle.textContent = title;
          }

          // focus effect on clicked
          container.querySelectorAll('.cs-thumb').forEach(function(t){ t.classList.remove('active'); });
          thumb.classList.add('active');
        });
      });

      // Load more toggle
      var loadMore = container.querySelector('.cs-load-more');
      if (loadMore) {
        loadMore.addEventListener('click', function(){
          var hidden = container.querySelectorAll('.cs-hidden');
          var expanded = loadMore.getAttribute('aria-expanded') === 'true';
          if (!expanded) {
            hidden.forEach(function(h){ h.classList.remove('cs-hidden'); });
            loadMore.setAttribute('aria-expanded', 'true');
            loadMore.textContent = 'Show less';
          } else {
            // hide indices >=3 again
            container.querySelectorAll('.cs-thumb').forEach(function(t, i){
              if (i >= 3) t.classList.add('cs-hidden');
            });
            loadMore.setAttribute('aria-expanded', 'false');
            var total = {{ total }};
            loadMore.textContent = 'Load more collections (' + (total - 3) + ')';
            // scroll left column to top on collapse (desktop)
            var leftCol = container.querySelector('.cs-left');
            if (leftCol) leftCol.scrollTop = 0;
          }
        });
      }
    })();
  </script>

  {% schema %}
  {
    "name": "Collection Showcase",
    "settings": [],
    "blocks": [
      {
        "type": "collection",
        "name": "Collection item",
        "settings": [
          {
            "type": "collection",
            "id": "collection",
            "label": "Choose collection"
          }
        ]
      }
    ],
    "max_blocks": 10,
    "presets": [
      {
        "name": "Collection Showcase",
        "category": "Collections"
      }
    ]
  }
  {% endschema %}
</section>