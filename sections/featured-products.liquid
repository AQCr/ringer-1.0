<section class="py-16 bg-white text-black relative overflow-hidden">
  <div class="container mx-auto px-4">
    {% if section.settings.show_hot_now and section.settings.hot_now_title != blank %}
      <div class="text-center mb-6">
        <h3 class="uppercase tracking-wide text-sm font-medium text-gray-500">{{ section.settings.hot_now_title }}</h3>
      </div>
    {% endif %}

    {% if section.settings.heading != blank %}
      <h2 class="text-3xl font-bold text-center mb-10">{{ section.settings.heading }}</h2>
    {% endif %}

    <div class="relative">
      <div id="featured-slider-{{ section.id }}" class="flex overflow-x-auto snap-x snap-mandatory scroll-smooth scrollbar-hide">
        {% for product in collections[section.settings.collection].products limit: section.settings.products_limit %}
          <div class="snap-start flex-none w-full sm:w-1/2 lg:w-1/3 px-3">
            <div class="border rounded-xl shadow-md overflow-hidden flex flex-col bg-white hover:shadow-lg transition">
              <a href="{{ product.url }}" class="block">
                {% if product.featured_image %}
                  <img src="{{ product.featured_image | image_url: width: 800 }}" width="" height="" alt="{{ product.title }}" class="w-full h-72 object-cover">
                {% endif %}
              </a>

              <div class="p-5 flex flex-col flex-grow justify-between">
                {% if section.settings.show_title %}
                  <h3 class="text-lg font-semibold mb-2">{{ product.title }}</h3>
                {% endif %}

                {% if section.settings.show_description %}
                  <p class="text-sm text-gray-700 mb-4">{{ product.description | strip_html | truncate: 80 }}</p>
                {% endif %}

                {% if section.settings.show_stars %}
                  <div class="flex items-center mb-4">
                    {% assign rating = product.metafields.reviews.rating.value | default: 4 %}
                    {% for i in (1..5) %}
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 {% if i <= rating %}text-yellow-400{% else %}text-gray-300{% endif %}" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.967a1 1 0 00.95.69h4.175c.969 0 1.371 1.24.588 1.81l-3.383 2.46a1 1 0 00-.364 1.118l1.287 3.966c.3.921-.755 1.688-1.538 1.118l-3.383-2.46a1 1 0 00-1.176 0l-3.383 2.46c-.783.57-1.838-.197-1.538-1.118l1.287-3.966a1 1 0 00-.364-1.118l-3.383-2.46c-.783-.57-.38-1.81.588-1.81h4.175a1 1 0 00.95-.69l1.286-3.967z" />
                      </svg>
                    {% endfor %}
                  </div>
                {% endif %}

                <div class="flex flex-col sm:flex-row gap-3 mt-auto">
                  {% if section.settings.show_add_to_cart %}
                    <form method="post" action={{ routes.cart_add_url }} class="w-full sm:w-1/2">
                      <input type="hidden" name="id" value="{{ product.variants.first.id }}">
                      <button type="submit" class="w-full bg-black text-white py-2 rounded-md hover:bg-gray-800 transition">Add to Cart</button>
                    </form>
                  {% endif %}

                  {% if section.settings.show_buy_now %}
                    <a href="{{ product.url }}" class="w-full sm:w-1/2 text-center border border-black py-2 rounded-md hover:bg-black hover:text-white transition">Buy Now</a>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      <!-- Navigation Arrows -->
      <button class="absolute left-0 top-1/2 -translate-y-1/2 bg-white border rounded-full w-10 h-10 flex items-center justify-center shadow hover:bg-gray-100 transition" id="prev-{{ section.id }}">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-800" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </button>

      <button class="absolute right-0 top-1/2 -translate-y-1/2 bg-white border rounded-full w-10 h-10 flex items-center justify-center shadow hover:bg-gray-100 transition" id="next-{{ section.id }}">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-800" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>

    <!-- Dots -->
    <div class="flex justify-center gap-2 mt-6" id="dots-{{ section.id }}"></div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const slider = document.getElementById("featured-slider-{{ section.id }}");
      const next = document.getElementById("next-{{ section.id }}");
      const prev = document.getElementById("prev-{{ section.id }}");
      const dotsContainer = document.getElementById("dots-{{ section.id }}");
      const slides = slider.children;
      const total = slides.length;
      let index = 0;

      // Create dots dynamically
      for (let i = 0; i < total; i++) {
        const dot = document.createElement("button");
        dot.classList.add("w-3", "h-3", "rounded-full", "bg-gray-300");
        if (i === 0) dot.classList.replace("bg-gray-300", "bg-black");
        dot.addEventListener("click", () => scrollToSlide(i));
        dotsContainer.appendChild(dot);
      }

      const dots = dotsContainer.querySelectorAll("button");

      function updateDots() {
        dots.forEach((d, i) => {
          d.classList.remove("bg-black");
          d.classList.add("bg-gray-300");
          if (i === index) d.classList.replace("bg-gray-300", "bg-black");
        });
      }

      function scrollToSlide(i) {
        index = i;
        slider.scrollTo({ left: slides[i].offsetLeft, behavior: "smooth" });
        updateDots();
      }

      next.addEventListener("click", () => {
        index = (index + 1) % total;
        scrollToSlide(index);
      });

      prev.addEventListener("click", () => {
        index = (index - 1 + total) % total;
        scrollToSlide(index);
      });
    });
  </script>
</section>
<style>
  /* âœ… Fully hide scrollbar across browsers */
  #featured-slider-{{ section.id }}::-webkit-scrollbar {
    display: none;
  }
  #featured-slider-{{ section.id }} {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const slider = document.getElementById("featured-slider-{{ section.id }}");
    const next = document.getElementById("next-{{ section.id }}");
    const prev = document.getElementById("prev-{{ section.id }}");
    const dotsContainer = document.getElementById("dots-{{ section.id }}");
    const slides = Array.from(slider.children);
    const total = slides.length;

    let index = 0;
    let visibleCount = getVisibleCount();

    function getVisibleCount() {
      if (window.innerWidth < 640) return 1; // mobile
      if (window.innerWidth < 1024) return 2; // tablet
      return 3; // desktop
    }

    function totalPages() {
      return Math.ceil(total / visibleCount);
    }

    function createDots() {
      dotsContainer.innerHTML = "";
      for (let i = 0; i < totalPages(); i++) {
        const dot = document.createElement("button");
        dot.classList.add(
          "w-3", "h-3", "rounded-full", "bg-gray-300", "transition-colors"
        );
        if (i === 0) dot.classList.replace("bg-gray-300", "bg-black");
        dot.addEventListener("click", () => scrollToPage(i));
        dotsContainer.appendChild(dot);
      }
    }

    function updateDots() {
      const dots = dotsContainer.querySelectorAll("button");
      dots.forEach((dot, i) => {
        dot.classList.remove("bg-black");
        dot.classList.add("bg-gray-300");
        if (i === index) dot.classList.replace("bg-gray-300", "bg-black");
      });
    }

    function scrollToPage(i) {
      index = i;
      const slideWidth = slides[0].offsetWidth + parseInt(getComputedStyle(slides[0]).marginRight);
      slider.scrollTo({ left: i * slideWidth * visibleCount, behavior: "smooth" });
      updateDots();
    }

    next.addEventListener("click", () => {
      index = (index + 1) % totalPages();
      scrollToPage(index);
    });

    prev.addEventListener("click", () => {
      index = (index - 1 + totalPages()) % totalPages();
      scrollToPage(index);
    });

    // Initialize
    createDots();

    // Recalculate when screen size changes
    window.addEventListener("resize", () => {
      visibleCount = getVisibleCount();
      createDots();
      index = 0;
      scrollToPage(0);
    });
  });
</script>


  {% schema %}
  {
    "name": "Featured Products",
    "settings": [
      { "type": "checkbox", "id": "show_hot_now", "label": "Show Hot Now Label", "default": true },
      { "type": "text", "id": "hot_now_title", "label": "Hot Now Title", "default": "Hot Now" },
      { "type": "text", "id": "heading", "label": "Section Heading", "default": "Our Featured Products" },
      { "type": "collection", "id": "collection", "label": "Select Collection" },
      { "type": "range", "id": "products_limit", "label": "Number of Products", "min": 3, "max": 6, "step": 1, "default": 3 },
      { "type": "checkbox", "id": "show_title", "label": "Show Product Title", "default": true },
      { "type": "checkbox", "id": "show_description", "label": "Show Product Description", "default": true },
      { "type": "checkbox", "id": "show_stars", "label": "Show Star Ratings", "default": true },
      { "type": "checkbox", "id": "show_add_to_cart", "label": "Show Add to Cart Button", "default": true },
      { "type": "checkbox", "id": "show_buy_now", "label": "Show Buy Now Button", "default": true }
    ],
    "presets": [
      { "name": "Featured Products", "category": "Products" }
    ]
  }
  {% endschema %}
